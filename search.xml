<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>MySQL-索引篇</title>
      <link href="/posts/mysql-family/1/"/>
      <url>/posts/mysql-family/1/</url>
      
        <content type="html"><![CDATA[<h1 id="MySQL-索引"><a href="#MySQL-索引" class="headerlink" title="MySQL-索引"></a>MySQL-索引</h1><h4 id="为什么要学习MySQL？"><a href="#为什么要学习MySQL？" class="headerlink" title="为什么要学习MySQL？"></a>为什么要学习MySQL？</h4><p>目前互联网公司多数都在使用，MySQL的数据结构和一些设计思想很值得学习，面试必问…</p><p>思考：生产上遇到的慢查询/慢SQL查询，解决方法通常是添加索引，添加索引后查询速度可以提升几个数量级怎么做到的？正常一条SQL执行速度是几十毫秒或者几百毫秒，慢SQL执行几秒甚至几十秒肯定是不合理的。</p><p>想要学好MySQL首先要理解<code>索引</code>的概念，索引可以帮助MySQL高效查找数据，是一个<font color="red">排好序</font>的<font color="red">数据结构</font>（排好序体现在从左到右依次递增）。</p><p>国外的一个数据结构图示化网址：<a href="https://www.cs.usfca.edu/~galles/visualization/">https://www.cs.usfca.edu/~galles/visualization/</a></p><span id="more"></span><h4 id="索引的数据结构有很多："><a href="#索引的数据结构有很多：" class="headerlink" title="索引的数据结构有很多："></a>索引的数据结构有很多：</h4><ul><li>二叉树</li></ul><p>也叫折半查找，可以快速定位到数据。特点是右子节点的数据一定大于父节点的数据，左子节点的数据一定小于父节点的数据。缺点是由于每个节点只保存单个数据，所以数据量越大树的高度就会越高，查询次数越多查询效率会变低，极端情况例如所有数据都在节点的同一侧，查询类似逐行查找效率很低。</p><p><img src="/images/mysql/BinarySearchTree.png" alt="Binary Search Tree"></p><ul><li>红黑树</li></ul><p>也叫二叉平衡树，在二叉树的基础上做了优化。当节点左右两侧树的高度相差较多时自动做平衡，可以提高一定的查询性能，同时在平衡过程中会带来一定的消耗（左旋右旋等）。数据量大时，同样有树的高度变高导致查询次数多而效率低的问题。Hashmap在1.8版本做了优化，数据结构改为数组＋链表和红黑树，后续再做详细总结。</p><p><img src="/images/mysql/RedBlackTree.png" alt="Red/Black Tree"></p><ul><li>hash</li></ul><p>对于等值查询支持良好，不支持范围查找。对索引键做hash运算后维护到hash表（hash表中保存磁盘文件的地址）中，并关联到数据在磁盘中的地址，可以一次快速查找到目标数据。MySQL实现了自己的hash算法（常见的MD5、CRC16、CRC32等都是hash算法），发生hash冲突时数据在hash桶后面追加。</p><ul><li>B-树</li></ul><p>思考：在红黑树的基础上，横向保存的节点越多，是不是就意味着树的高度越低？</p><p>单个节点可以保存更多的数据。数据量大时，可以明显的降低树的高度，减少查询次数从而提高性能。</p><p>特点：叶子节点具有相同的深度，且指针为空；所有索引元素不重复；节点的数据索引左到右依次递增。</p><p><img src="/images/mysql/BTrees.png" alt="B Trees"></p><p>MySQL的B-树：</p><p><img src="/images/mysql/MySQLBTree.png" alt="MySQL B Trees"></p><ul><li>B+树</li></ul><p>MySQL索引没有选择纯粹的B-树，而是对其进行优化，使用B＋树（B-树变种）作为底层的数据结构，B＋树这种数据结构数据量越大性能提升的越明显。</p><p>B＋树的叶子节点（磁盘页）保存着多条索引和数据，把每个叶子节点上的第一个索引提取出来作为冗余保存在非叶子节点中，非叶子节点大小固定且只保存索引（严格上还有和叶子节点关联的指针），非叶子节点保存更多的索引理论上就代表可以保存更多的数据。</p><p>特点：非叶子节点不存储data，只保存冗余索引，可保存更多索引；叶子节点包含所有索引字段；叶子节点用指针连接，提高区间访问性能。</p><p><img src="/images/mysql/B+Trees.png" alt="B+Trees"></p><p>MySQL的B+树：</p><p><img src="/images/mysql/MySQLB+Trees.png" alt="MySQL B+Trees"></p><p>MySQL对B+树同样做了优化：叶子节点间使用的是双向指针，B+树原本使用的是单向指针</p><p>B＋树相对B-树做了哪些优化？</p><p>a）B＋树的非叶子节点只保存索引，而B-树的非叶子节点保存索引和数据。B+树的叶子节点包含所有的索引元素</p><p>b）B＋树相邻的叶子节点之间有双向的指针，保存相邻节点的磁盘地址，范围查找更友好</p><p>补充：MySQL的数据是保存在磁盘中，存储位置在磁盘中随机，取决于写数据时通过磁道写入的磁盘位置。查询数据时的性能消耗主要发生在磁盘IO，当查找数据时从根节点开始，将磁盘页load到内存中和查询条件比较，把满足条件的下一个磁盘页load到内存中再次比较查找，重复操作最终找到目标数据。</p><p>个人理解：树的高度越低，磁盘页load到内存的次数越少，IO少了所以性能会更高。</p><p>优化：所有的根节点作为常驻内存保存。非叶子节点也可以作为内存进行保存。</p><h4 id="为什么MySQL选择B-树而不是B-树？"><a href="#为什么MySQL选择B-树而不是B-树？" class="headerlink" title="为什么MySQL选择B+树而不是B-树？"></a>为什么MySQL选择B+树而不是B-树？</h4><p>每个节点（磁盘页）大小的选择是有讲究的，默认为16kb大小（16384b），大小可以修改但是不推荐。</p><p>数据表中每一行的数据通常不会超过1kb（按照表中几十个字段估算，没有文本格式大文件的情况），这样每个叶子节点可以保存16条数据</p><p>使用B-树时：非叶子节点同样保存data数据，<code>数据总量 = 16 ^ n </code>，其中n代表树的高度</p><p>使用B+树时：B+树的非叶子节点保存的是索引（按大点算bigint格式占8字节）和指向下一个磁盘页的指针地址（C语言实现约占6字节），这样非叶子节点可以保存的索引个数约为：<code>16384 / (8+6) = 1170</code>，三层高度的树可以保存数据总量约为：<code>1170 * 1170 * 16</code>，两千万+数据</p><p>B+树的高度是由非叶子节点存放的元素个数决定的，存放的越多树的高度越低，查询效率也就越高（load到内存的I/O次数少）。显然相同数据量的情况下，B+树的高度远远小于B-树，性能更高</p><h4 id="InnoDB索引（聚集）和MyISAM索引（非聚集）："><a href="#InnoDB索引（聚集）和MyISAM索引（非聚集）：" class="headerlink" title="InnoDB索引（聚集）和MyISAM索引（非聚集）："></a>InnoDB索引（聚集）和MyISAM索引（非聚集）：</h4><p>InnoDB存储引擎保存的索引和数据在同一个文件中 .ibd</p><p>MyISAM存储引擎保存的索引和数据在不同的文件中 .MYD 和 .MYI</p><p>注意：存储引擎描述的是数据表而不是描述数据据，最终生效的肯定是修饰数据表的存储引擎</p><p>存储引擎和磁盘保存文件格式的关系：</p><p><img src="/images/mysql/datasave.png" alt="datasave"></p><h4 id="为什么DBA推荐创建InnoDB存储引擎的表时必须创建主键？"><a href="#为什么DBA推荐创建InnoDB存储引擎的表时必须创建主键？" class="headerlink" title="为什么DBA推荐创建InnoDB存储引擎的表时必须创建主键？"></a>为什么DBA推荐创建InnoDB存储引擎的表时必须创建主键？</h4><p>开发人员在设计InnoDB表的时候，ibd文件必须要用一个B+树的数据文件来组织</p><p>表自带主键索引的情况，直接用主键索引来组织整张表的所有数据</p><p>不创建主键时，从表的第一列开始选择所有数据都不相等的列来组织B+树</p><p>如果选不到，MySQL会创建一个隐藏列来组织整张表的数据</p><p>为了减少MySQL的工作量，索引应该由我们程序员提前创建好</p><h4 id="为什么DBA推荐创建InnoDB存储引擎的表时使用整型的自增主键？"><a href="#为什么DBA推荐创建InnoDB存储引擎的表时使用整型的自增主键？" class="headerlink" title="为什么DBA推荐创建InnoDB存储引擎的表时使用整型的自增主键？"></a>为什么DBA推荐创建InnoDB存储引擎的表时使用整型的自增主键？</h4><p>索引定位查找数据时，都是从根节点开始查找数据并比较</p><p>整型数字的比较速度比字符串（逐个字符比较ASCII码）比较速度快</p><p>另外整型和字符串或者uuid相比，更能节省磁盘空间（通常比较贵SSD）</p><p>索引维护到B+树中会排好序，自增每次新增都添加到树的最后，减少树的分裂和平衡</p><h4 id="InnoDb存储引擎的主键索引树和二级索引树的区别？"><a href="#InnoDb存储引擎的主键索引树和二级索引树的区别？" class="headerlink" title="InnoDb存储引擎的主键索引树和二级索引树的区别？"></a>InnoDb存储引擎的主键索引树和二级索引树的区别？</h4><p>主键索引树的叶子节点保存表中所有的数据</p><p>二级索引树的叶子节点保存组织整张表数据的聚集索引的值（通常是主键，也可能是MySQL选择的列或者隐藏列rowid）</p><p>MySQL这样设计可以减少数据的冗余节省存储空间，也保证了数据的一致性减少复杂度</p><p>二级索引查找数据时，是先找到主键索引，再通过主键索引回表到聚簇索引上面找到目标数据</p><p>二级索引其实也是稀疏的，是非聚簇索引</p><p><strong>联合索引：</strong>多个字段共同组织成一个索引</p><p>理想情况是通过1到3个联合索引把业务上80%的查询覆盖到，在加上几个单值索引覆盖剩余的业务</p>]]></content>
      
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>YeahWorld</title>
      <link href="/posts/blog-get//"/>
      <url>/posts/blog-get//</url>
      
        <content type="html"><![CDATA[<blockquote><p>距上次写Blog 近一年，由于最近换新工作，换了工作电脑所以决定切换主题从心开始</p></blockquote><br><p>0、安装Hexo前置条件：<code>Node.js</code> 和 <code>Git</code> 安装完成</p><p>（node -v，npm -v，git –version查看是否已安装）</p><p><code>Node.js</code> 和 <code>Git</code> 没有安装的同学请自行查找安装方法，资料很多且不复杂</p><br><p>1、安装Hexo客户端命令：<code>npm install -g hexo-cli</code></p><p>问题：执行上述安装Hexo命令，窗口提示 <font color="red">idealTree:npm: sill idealTree buildDeps</font></p> <span id="more"></span> <p>解决：(产生问题的原因是，国外镜像链接失败)</p><pre class=" language-java"><code class="language-java"># 设置为国内的阿里镜像npm config set registry https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>registry<span class="token punctuation">.</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org# 检查阿里镜像是否设置成功npm config get registry# 镜像设置成功后展示如下https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>registry<span class="token punctuation">.</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org<span class="token operator">/</span></code></pre><p>切换镜像后，重新执行安装客户端命令，执行成功！</p><br><p>2、Hexo安装完成后执行如下命令，Hexo会在<code>&lt;folder&gt;</code>文件夹下创建所需文件：</p><pre class=" language-java"><code class="language-java">$ hexo init <span class="token operator">&lt;</span>folder<span class="token operator">></span>$ cd <span class="token operator">&lt;</span>folder<span class="token operator">></span>$ npm install</code></pre><p>进入到 Hexo 安装路径，执行 <code>hexo s</code>命令，启动成功后按照提示访问<code>http://localhost:4000/</code> </p><br><p>3、Hexo常用命令（这里直接拷贝<code>helloworld</code> 中的快速开始）</p><p><strong>Create a new post</strong></p><pre class=" language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><p><strong>Run server</strong></p><pre class=" language-bash"><code class="language-bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><p><strong>Generate static files</strong></p><pre class=" language-bash"><code class="language-bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><p><strong>Deploy to remote sites</strong></p><pre class=" language-bash"><code class="language-bash">$ hexo deploy</code></pre><p>More info:  <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p><br><p>4、Hexo安装完成，首先想到的就是主题。之前使用的是<a href="https://butterfly.js.org/">butterfly</a>主题，尝试过不少美化和特效，现在换成<a href="https://github.com/iissnan/hexo-theme-next/">next</a>主题看起来更加精简，可惜了之前的全局自动播放音乐插件（花了不少时间做好的，心碎~）</p><br><p>5、主题有了，添加背景音乐（情有独钟，因为小时候觉得QQ空间的背景音乐很酷）</p><p>这里笔者使用的是<font color="red">网易云插件的外链</font>来做背景音乐，全局音乐没得问题，可惜进入Blog没有自动播放</p><p>网易云外链获取方式：登录网易云进入目标歌单（或单曲），点击分享 链接使用浏览器打开，生成外链即可</p><p>参考文章：<a href="https://blog.csdn.net/qq_39720594/article/details/105401774">Hexo + Next 主题实现全局播放背景音乐</a></p><p>文中推荐的<font color="red">使用Aplayer + MetingJS插件</font>笔者多次尝试扔没有成功（许是遗漏操作）</p><br><p>6、使用 live2 在页面右下 添加萌娘，简单有趣</p><p>a) 准备工作，执行下面命令</p><pre class=" language-java"><code class="language-java"># 安装 live2 插件npm install <span class="token operator">--</span>save hexo<span class="token operator">-</span>helper<span class="token operator">-</span>live2d# 安装人物模型 https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>xiazeyu<span class="token operator">/</span>live2d<span class="token operator">-</span>widget<span class="token operator">-</span>modelsnpm install live2d<span class="token operator">-</span>widget<span class="token operator">-</span>model<span class="token operator">-</span>koharu</code></pre><p>b) hexo 安装目录<code>_config.yml</code>配置文件添加如下：</p><pre class=" language-java"><code class="language-java">live2d<span class="token operator">:</span>  enable<span class="token operator">:</span> <span class="token boolean">true</span>  scriptFrom<span class="token operator">:</span> local  model<span class="token operator">:</span>     use<span class="token operator">:</span> live2d<span class="token operator">-</span>widget<span class="token operator">-</span>model<span class="token operator">-</span>koharu #模型选择  display<span class="token operator">:</span>     position<span class="token operator">:</span> right  #模型位置    width<span class="token operator">:</span> <span class="token number">150</span>       #模型宽度    height<span class="token operator">:</span> <span class="token number">300</span>      #模型高度  mobile<span class="token operator">:</span>     show<span class="token operator">:</span> <span class="token boolean">false</span>      #是否在手机端显示</code></pre><p>c) 重启验证是否生效：<code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</code></p><br><p>7、参考文章：<a href="https://jlj98.top/hexo-instructions/">Hexo搭建博客</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 扬帆起航 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
